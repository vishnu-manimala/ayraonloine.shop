<%- include('../layouts/headerUser.ejs') %>

    <section class="container">
        <div class="row d-flex mb-md-3 ">
            <div class="col-md-3">
                <aside class="side-bar">
                    <div class=" container-fluid d-flex p-1   bg-white mt-md-4 shadow"
                        style="border-radius: 10px;box-shadow:dodgerblue; ">
                        <div class="col-md-4 pt-lg-1 ">
                            <img src=" ../../../../../productImages/<%= userdata.profileImage %>"
                                style="height: 60px; width: 60px;border-radius: 50%;">
                        </div>
                        <div class="col-md-8 pt-lg-2">
                            <div>
                                <span>Hello</span>
                            </div>
                            <div>
                                <h6 style="color: #38b4d0;"><%= userdata.name %></h6>
                            </div>
                        </div>
                    </div>

                    <div class="container-fluid bg-white p-1 pt-lg-2 mt-md-4 "
                        style="border-radius: 10px;box-shadow:dodgerblue; ">
                        <div class="  d-flex ">
                            <div class="col-md-2 pt-lg-1 ">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-person-fill-gear" viewBox="0 0 16 16" style="color: #38b4d0;">
                                    <path
                                        d="M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm-9 8c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Zm9.886-3.54c.18-.613 1.048-.613 1.229 0l.043.148a.64.64 0 0 0 .921.382l.136-.074c.561-.306 1.175.308.87.869l-.075.136a.64.64 0 0 0 .382.92l.149.045c.612.18.612 1.048 0 1.229l-.15.043a.64.64 0 0 0-.38.921l.074.136c.305.561-.309 1.175-.87.87l-.136-.075a.64.64 0 0 0-.92.382l-.045.149c-.18.612-1.048.612-1.229 0l-.043-.15a.64.64 0 0 0-.921-.38l-.136.074c-.561.305-1.175-.309-.87-.87l.075-.136a.64.64 0 0 0-.382-.92l-.148-.045c-.613-.18-.613-1.048 0-1.229l.148-.043a.64.64 0 0 0 .382-.921l-.074-.136c-.306-.561.308-1.175.869-.87l.136.075a.64.64 0 0 0 .92-.382l.045-.148ZM14 12.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0Z" />
                                </svg>
                            </div>
                            <div class="col-md-10 pt-lg-2">
                                <h6 style="color: #38b4d0;">Account Settings</h6>
                            </div>
                        </div>

                        <div class="container ps-5 pt-lg-2">
                            <div class="col-12 ps-2 ">
                                <a href="/user_profile"><span style="font-size:small;"> Profile Information</span></a>
                            </div>
                            <div class="col-12 ps-2 pt-lg-2">
                                <a href="/profile/address_manager"> <span
                                        style="font-size:small;text-decoration: none;color: palevioletred;"> Manage
                                        Address</span></a>
                            </div>
                            <!-- <div class="col-12 ps-2 pt-lg-2">
                                <a href="/profile/pancard"><span style="font-size:small;"> PAN Card Information</span></a>
                            </div> -->
                        </div>

                        <div class=" container-fluid d-flex p-1 bg-white mt-lg-2">
                            <div class="col-md-2 pt-lg-1 ">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-box-fill" viewBox="0 0 16 16" style="color: #38b4d0;">
                                    <path fill-rule="evenodd"
                                        d="M15.528 2.973a.75.75 0 0 1 .472.696v8.662a.75.75 0 0 1-.472.696l-7.25 2.9a.75.75 0 0 1-.557 0l-7.25-2.9A.75.75 0 0 1 0 12.331V3.669a.75.75 0 0 1 .471-.696L7.443.184l.004-.001.274-.11a.75.75 0 0 1 .558 0l.274.11.004.001 6.971 2.789Zm-1.374.527L8 5.962 1.846 3.5 1 3.839v.4l6.5 2.6v7.922l.5.2.5-.2V6.84l6.5-2.6v-.4l-.846-.339Z" />
                                </svg>
                            </div>
                            <div class="col-md-10 pt-lg-2">
                                <a href="/profile/orders"><h6 style="color: #38b4d0;">Orders</h6></a>
                            </div>
                        </div>
                        <div class=" container-fluid d-flex p-1 bg-white">
                            <div class="col-md-2 pt-lg-1 ">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-bag-check-fill" viewBox="0 0 16 16" style="color: #38b4d0;">
                                    <path fill-rule="evenodd"
                                        d="M10.5 3.5a2.5 2.5 0 0 0-5 0V4h5v-.5zm1 0V4H15v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V4h3.5v-.5a3.5 3.5 0 1 1 7 0zm-.646 5.354a.5.5 0 0 0-.708-.708L7.5 10.793 6.354 9.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3z" />
                                </svg>
                            </div>
                            <div class="col-md-10 pt-lg-2">
                                <h6 style="color: #38b4d0;">Cart</h6>
                            </div>
                        </div>
                        <div class=" container-fluid d-flex p-1 ">
                            <div class="col-md-2 pt-lg-1 ">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-heart-fill" viewBox="0 0 16 16" style="color: #38b4d0;">
                                    <path fill-rule="evenodd"
                                        d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z" />
                                </svg>
                            </div>
                            <div class="col-md-10 pt-lg-2">
                                <h6 style="color: #38b4d0;">Wishlist</h6>
                            </div>
                        </div>
                        <!-- <div class=" container-fluid d-flex p-1 bg-white">
                            <div class="col-md-2 pt-lg-1 ">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-wallet2" viewBox="0 0 16 16" style="color: #38b4d0;">
                                    <path
                                        d="M12.136.326A1.5 1.5 0 0 1 14 1.78V3h.5A1.5 1.5 0 0 1 16 4.5v9a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 13.5v-9a1.5 1.5 0 0 1 1.432-1.499L12.136.326zM5.562 3H13V1.78a.5.5 0 0 0-.621-.484L5.562 3zM1.5 4a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-13z" />
                                </svg>
                            </div>
                            <div class="col-md-10 pt-lg-2">
                                <h6 style="color: #38b4d0;">Wallet</h6>
                            </div>
                        </div>
                        <div class=" container-fluid d-flex p-1 bg-white">
                            <div class="col-md-2 pt-lg-1 ">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-card-list" viewBox="0 0 16 16" style="color: #38b4d0;">
                                    <path
                                        d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z" />
                                    <path
                                        d="M5 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 5 8zm0-2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-1-5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zM4 8a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zm0 2.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z" />
                                </svg>
                            </div>
                            <div class="col-md-10 pt-lg-2">
                                <h6 style="color: #38b4d0;">Manage Coupon</h6>
                            </div>
                        </div> -->
                    </div>
                </aside>
            </div>
            <div class="col-md-9">
                <div class="container-fluid p-1 bg-white mt-md-4 shadow"
                    style="border-radius: 10px; box-shadow: 0 0 10px #38b4d0;">
                    <div class="container ">
                        <div class="col-md-12 p-lg-5" id="addressManager">
                            <div class="pt-md-2">
                                <h6>Manage Address</h6>
                                <div id="addNewAddress">
                                    <button class="btn border-0 bg-white" style="color: #38b4d0;" onclick="displayForm()">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
                                            <path
                                                d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                                            <path
                                                d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                                        </svg>
                                        ADD A NEW ADDRESS
                                    </button>
                                </div>
                                <div class="conatiner" id="addressForm" style="display: none;">
                                    <form class="form-group p-lg-3" action="/profile/address_manager?id=addressManager" method="post">
                                        <h6> ADD A NEW ADDRESS</h6>
                                        <div class="container row d-flex p-lg-1">

                                            <div class="col-md-6  ">
                                                <input class="form-control" type="text" id="name" name="name" placeholder="Name">
                                            </div>
                                            <div class="col-md-6  " id="profileImage">
                                                <input class="form-control no-arrows"  id="phone" name="phone" type="number"
                                                    placeholder="10 digit phone number">
                                            </div>
                                        </div>
                                        <div class="container row d-flex p-lg-1">

                                            <div class="col-md-6  ">
                                                <input class="form-control" type="text" name="houseNum" id="houseNum" placeholder="House No/Name">
                                            </div>
                                            <div class="col-md-6 " >
                                                <input class="form-control no-arrows" type="number" name="pincode" id="pincode"
                                                    placeholder="Pincode">
                                            </div>
                                        </div>
                                        <div class="container row d-flex p-lg-1">

                                            <div class="col-md-12  ">
                                                <input class="form-control no-arrows " type="tex" name="addressTextarea"
                                                    placeholder="Address (Area and Street)" id="addressTextarea"></input>

                                            </div>

                                        </div>
                                        <div class="container row d-flex p-lg-1">

                                            <div class="col-md-6  ">
                                                <input class="form-control" type="text" name="city"
                                                    placeholder="City/District/Town" id="city">
                                            </div>
                                            <div class="col-md-6 " id="profileImage">
                                                <input class="form-control " type="text" name="state" id="state" placeholder="State">
                                            </div>
                                        </div>
                                        <div class="container row d-flex p-lg-1">

                                            <div class="col-md-6  ">
                                                <input class="form-control" type="text" id="landmark" name="landmark"
                                                    placeholder="Landmark(optional)">
                                            </div>
                                            <div class="col-md-6 " id="profileImage">
                                                <input class="form-control " type="text" id="alternatePhone" name="alternatePhone"
                                                    placeholder="Alternate Phone number">
                                            </div>
                                        </div>
                                        <div class="container row d-flex mt-md-3  p-lg-1">

                                            <div class="col-md-6 text-md-end ">
                                                <button class="btn w-50 " style="background-color: #38b4d0;"
                                                    type="submit" > SAVE</button>
                                            </div>
                                            <div class="col-md-6 text-md-start " id="profileImage">
                                                <button type="button" class="btn w-50 bg-white" onclick="onCancel()">CANCEL</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <!-- Saved Addresses -->
                                <div class=" p-lg-1" id="addressDetails">
                                    <h6 class="ps-md-2 pt-lg-3">Saved Addresses</h6>
                                    <% if(userdata){ %>
                                        <% userdata.address.items.forEach((element)=>{ %>
                                    <div class=" row d-flex ps-lg-3">
                                        <div class="col-md-10 p-lg-1" id="profileDetails">
                                            <!-- <div class="pt-md-2 ps-lg-3">
                                                <span>Adderess Type</span>
                                            </div> -->
                                            <div class="container d-flex list-unstyled">
                                                <span class="justify-content-start">
                                                    <%= element.name %>,
                                                </span>
                                                <span class="justify-content-start">
                                                   <%= element.phone %>
                                                </span>   
                                            </div>
                                            <div class="container d-flex list-unstyled">
                                                <span >
                                                    <%= element.HouseNum %>,
                                                </span>
                                                <span >
                                                    <%= element.address %>,
                                                </span>
                                                <span >
                                                    <%= element.city %>,
                                                </span>
                                                <span >
                                                    <%= element.landmark %>  
                                                </span>
                                            </div>
                                            <div class="container d-flex list-unstyled">
                                                <span >
                                                    <%= element.state %>,
                                                </span>
                                                <span class="ps-1">
                                                    <%= element.pincode %>,
                                                </span>
                                                <span class="ps-1">
                                                    <%= element.alternatePhone %>
                                                </span>
                                            </div>
                                            <div class="container d-flex list-unstyled">
                                                <span>
                                                    Altenate Phone:
                                                </span>
                                                <span class="ps-1">
                                                    <%= element.alternatePhone %>
                                                </span>
                                            </div>
                                           
                                        </div>
                                        <div class="col-md-2 pt-5 " >
                                            <div>
                                                <button class="btn border-0 bg-white" type="submit" onclick="editAddress('<%= JSON.stringify(element)  %>')">
                                                    Edit
                                                </button>
                                            </div>
                                            <div>
                                                <button class="btn border-0 bg-white" type="submit" onclick="deleteAddress('<%= element._id  %>')">
                                                    Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <% }) %>
                                 <% } %>
                                </div>
                                <div class="conatiner mt-3" id="editAddressForm" style="display: none;">
                                  
                                        <h6> EDIT ADDRESS</h6>
                                        <div class="container row d-flex p-lg-1">

                                            <div class="col-md-6  ">
                                                <input class="form-control" type="text" id="nameEdit" name="name" placeholder="Name">
                                            </div>
                                            <div class="col-md-6  " id="profileImage">
                                                <input class="form-control no-arrows"  id="phoneEdit" name="phone" type="number"
                                                    placeholder="10 digit phone number">
                                            </div>
                                        </div>
                                        <div class="container row d-flex p-lg-1">

                                            <div class="col-md-6  ">
                                                <input class="form-control" type="text" name="houseNum" id="houseNumEdit" placeholder="House No/Name">
                                            </div>
                                            <div class="col-md-6 " >
                                                <input class="form-control no-arrows" type="number" name="pincode" id="pincodeEdit"
                                                    placeholder="Pincode">
                                            </div>
                                        </div>
                                        <div class="container row d-flex p-lg-1">

                                            <div class="col-md-12  ">
                                                <input class="form-control no-arrows " type="tex" name="addressTextarea"
                                                    placeholder="Address (Area and Street)" id="addressTextareaEdit"></input>

                                            </div>

                                        </div>
                                        <div class="container row d-flex p-lg-1">

                                            <div class="col-md-6  ">
                                                <input class="form-control" type="text" name="city"
                                                    placeholder="City/District/Town" id="cityEdit">
                                            </div>
                                            <div class="col-md-6 " id="profileImage">
                                                <input class="form-control " type="text" name="state" id="stateEdit" placeholder="State">
                                            </div>
                                        </div>
                                        <div class="container row d-flex p-lg-1">

                                            <div class="col-md-6  ">
                                                <input class="form-control" type="text" id="landmarkEdit" name="landmark"
                                                    placeholder="Landmark(optional)">
                                            </div>
                                            <div class="col-md-6 " id="profileImage">
                                                <input class="form-control " type="text" id="alternatePhoneEdit" name="alternatePhone"
                                                    placeholder="Alternate Phone number">
                                            </div>
                                        </div>
                                        <div class="container row d-flex mt-md-3  p-lg-1">

                                            <div class="col-md-6 text-md-end ">
                                                <button class="btn w-50 " style="background-color: #38b4d0;"
                                                    type="button" onclick="updateAddress()" > SAVE</button>
                                            </div>
                                            <div class="col-md-6 text-md-start " id="profileImage">
                                                <button type="button" class="btn w-50 bg-white" onclick="onCancel()">CANCEL</button>
                                            </div>
                                        </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </section>
<script>

    let editAddreesId ;
    function displayForm(){
        
        document.getElementById('addNewAddress').style.display = 'none';
        document.getElementById('addressForm').style.display = 'block';
    }

    function onCancel(){
        location.reload();
        
    }

    function editAddress(data){
        try{
            const element = JSON.parse(data)
            console.log(element)
            editAddreesId = element._id;
            document.getElementById('addressDetails').style.display = "none";  
            document.getElementById('editAddressForm').style.display = "block";  
            document.getElementById('nameEdit').value = element.name;
            document.getElementById('phoneEdit').value =element.phone;
            document.getElementById('houseNumEdit').value = element.HouseNum;
            document.getElementById('pincodeEdit').value=element.pincode ;
            document.getElementById('addressTextareaEdit').value =element.address;
            document.getElementById('cityEdit').value=element.city;
            document.getElementById('stateEdit').value=element.state;
            document.getElementById('landmarkEdit').value=element.landmark;
            document.getElementById('alternatePhoneEdit').value=element.alternatePhone;
           
        }catch(err){
            console.log(err.message);
        }
    }


    function updateAddress(){
        console.log(editAddreesId)
        const data= {
            name : document.getElementById('nameEdit').value,
            phone:document.getElementById('phoneEdit').value,
            HouseNum:document.getElementById('houseNumEdit').value,
            pincode:document.getElementById('pincodeEdit').value,
            address:document.getElementById('addressTextareaEdit').value,
            city:document.getElementById('cityEdit').value,
            state:document.getElementById('stateEdit').value,
            landmark:document.getElementById('landmarkEdit').value,
            alternatePhone:document.getElementById('alternatePhoneEdit').value
        }
        const options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ data, editAddreesId })
            }
        fetch('/api/updateAddress',options)
        .then(response => response.json())
                .then(data => {
                    console.log(data);
                    if (data === "blocked") {
                            window.location.href = '/login'
                    }
                    if (data) {
                        location.reload();
                    } else {
                        console.log(data);
                    }
                }) 
    }


function deleteAddress(id){
    addressId = id;
    const options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({id })
    }
    fetch('/api/deleteAddress',options)
    .then(response=>response.json())
    .then(data=>{
        
        if (data === "blocked") {
            window.location.href = '/login'
        }
        console.log(data)
        if(data){
            location.reload()
        }
    })
}
</script>
    <%- include('../layouts/footer.ejs') %>