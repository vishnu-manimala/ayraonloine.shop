<%- include('./layout/header.ejs') %>
  <div class="container text-center mb-3" >
    <form action="/admin/report" method="post">

      <div class="row m-md-1 bg-white pb-2 shadow rounded ">
        
        <div class="col-md-2 grid-margin stretch-card pt-3">
          <select class="form-select form-select-sm" style="width: 100%; border-color: palevioletred;
          border-width: 1px; color: rgb(15, 1, 3); border-radius: 20px; font-weight:
           bold; margin-bottom: 5px; margin-top: 5px;" aria-label=".form-select-sm example" name="salesRe" id="sales"
            onchange="getData()">
            <option selected>Sales Category</option>
            <option value="Daily">Daily</option>
            <option value="Monthly">Monthly</option>
            <option value="Yearly">Yearly</option>
          </select>
        </div>
        <div class="col-md-2 grid-margin stretch-card pt-3" style="display: none;" id="chooseMonth">
          <select class=" form-select form-select-sm" style="width: 100%; border-color: palevioletred;
            border-width: 1px; color: rgb(15, 1, 3); border-radius: 20px; font-weight:
            bold; margin-bottom: 5px; margin-top: 5px;" aria-label=".form-select-sm example" name="month">
            <option selected>Monthly</option>
            <option value="2023-01-01">January 2023</option>
            <option value="2023-02-01">February 2023</option>
            <option value="2023-03-01">March 2023</option>
            <option value="2023-04-01">April 2023</option>
            <option value="2023-05-01">May 2023</option>
            <option value="2023-06-01">June 2023</option>
            <option value="2023-07-01">July 2023</option>
            <option value="2023-08-01">August 2023</option>
            <option value="2023-09-01">September 2023</option>
            <option value="2023-10-01">October 2023</option>
            <option value="2023-11-01">November 2023</option>
            <option value="2023-12-01">December 2023</option>
          </select>

        </div>
        <div class="col-md-2 grid-margin stretch-card pt-3" style="display: none;" id="chooseDay">
          <input type="date" name="today">

        </div>
        <div class="col-md-2 grid-margin stretch-card pt-3" style="display: none;" id="chooseYear">
          <select class=" form-select form-select-sm" style="width: 100%; border-color: palevioletred;
            border-width: 1px; color: rgb(15, 1, 3); border-radius: 20px; font-weight:
            bold; margin-bottom: 5px; margin-top: 5px;" aria-label=".form-select-sm example" name="year">
            <option selected>Year</option>
            <option value="2023"> 2023</option>

          </select>

        </div>
        <div class="col-md-2 grid-margin stretch-card pt-3">
          <button class="btn border-0 bg-transparent text-success" type="submit">submit</button>
        </div>

      </div>
    </form>
    <!--  #################  Head Portion: total order,product& user #########-->
    <div class="row text-center mt-2">
      <div class="col-lg-12 ">
        <div class="card" >
          <div class="card-body">
            <h4 class="card-title p-2">Admin Dashboard</h4>
            <div class="row ">
              <div class="col-md-3 stretch-card grid-margin">
                <div class="card bg-gradient-danger shadow">
                  <div class="card-body">
                    <h4 class="mb-3">Total Orders
                    </h4>

                    <h2 class="mb-5">
                      <%= data.totalOrders %>
                    </h2>

                  </div>
                </div>
              </div>
              <div class="col-md-3 stretch-card grid-margin">
                <div class="card bg-gradient-danger shadow">
                  <div class="card-body">

                    <h4 class="mb-3" style="color: palevioletred;">Total Sale
                    </h4>

                    <h2 class="mb-5">
                      <%= data.totalSaleAmount %>
                    </h2>
                  </div>
                </div>
              </div>
              <div class="col-md-3 stretch-card grid-margin">
                <div class="card bg-gradient-info card-img-holder shadow">
                  <div class="card-body">
                    <h4 class="font-weight-normal mb-3">Total Users
                    </h4>
                    <h2 class="mb-5">
                      <%= data.totalUsers %>
                    </h2>

                  </div>
                </div>
              </div>
              <div class="col-md-3 stretch-card grid-margin">
                <div class="card bg-gradient-success card-img-holder shadow">
                  <div class="card-body">
                    <h4 class="font-weight-normal mb-3">Total Products
                    </h4>
                    <h2 class="mb-5">
                      <%= data.totalProducts %>
                    </h2>

                  </div>  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--  #################  end ################# -->


    <!--  #################  Sales Section ################# -->
    <div class="container m-md-1 bg-white rounded ">
      <!--  #################  Nav ################# -->
      
      <!--  ~~~~~~~~~~~~~~~~~~~~~~  Nav end ~~~~~~~~~~~~~~~~~~~~~~ -->


      <!--  #################  Chart Section of Full Orders ################# -->
      <div class="row mt-md-2 pb-md-2 shadow" id="totalSales">
        <div class="col-md-7 grid-margin stretch-card">
          <div class="card">
            <div class="card-body">
              <div class="clearfix">
                <h4 class="card-title float-left">Sales Statistics</h4>
                <div id="visit-sale-chart-legend" class="rounded-legend legend-horizontal legend-top-right float-right">
                </div>

              </div>

              <canvas id="myChart" class="shadow p-2"></canvas>

            </div>
          </div>
        </div>
        <div class="col-md-5 grid-margin stretch-card">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title pb-3">Orders</h4>

              <h5 class="pb-md-1 ">Total Number of Orders: <%= data.totalOrders %>
              </h5>
              <h6 class="pb-md-1">Total Number of deliveries: <%= data.totalDelivery %>
              </h6>
              <h6 class="pb-md-1">Total Number of cancellations: <%= data.totalCancelled %>
              </h6>
              <h6 class="pb-md-5">Total Number of returns: <%= data.totalReturn %>
              </h6>
            </div>
          </div>
        </div>
      </div>
      <!--  ~~~~~~~~~~~~~~~~~~~~~~  Nav end ~~~~~~~~~~~~~~~~~~~~~~ -->


      <!--  #################  Monthly Sales ################# -->
      <!-- <div class="row mt-md-2 pb-md-2 text-center shadow" id="totalSales">
      <h4 class="p-2" style="color: palevioletred;">Monthly Sales</h4>
      <div class="row mt-md-2 pb-md-2">
        <div class="col-md-7 grid-margin stretch-card">
          <div class="card">
            <div class="card-body">
              <div class="clearfix">
                <h4 class="card-title float-left">Monthly Sales Statistics</h4>
                <div id="visit-sale-chart-legend" class="rounded-legend legend-horizontal legend-top-right float-right"></div>
               
              </div>
            
                <canvas id="myChartMonthly" class="shadow p-2"></canvas>
            
            </div>
          </div>
        </div>
        <div class="col-md-5 grid-margin stretch-card">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title pb-3">Orders</h4>
            
              <h5 class="pb-md-1 " id="ord" >Total Number of Orders: <%= data.totalOrders %> </h5>
              <h6 class="pb-md-1" id="deli">Total Number of deliveries: <%= data.totalDelivery %> </h6>
              <h6 class="pb-md-1" id="can">Total Number of cancellations: <%= data.totalCancelled %> </h6>
              <h6 class="pb-md-5" id="ret">Total Number of returns: <%= data.totalReturn %> </h6>
            </div>
          </div>
        </div>
      </div>
     
       
    </div> -->
      <!--  ~~~~~~~~~~~~~~~~~~~~~~  Monthly end ~~~~~~~~~~~~~~~~~~~~~~ -->
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>

    //Fetch Data *****************************************************************
    function fetchSalesData(url, options, type, id) {

      fetch(url, options)
        .then(response => response.json())
        .then(data => {

          console.log(data);

          createGraph(data, type, id)


        })
    }

    //select sales Order Type*******************************************************
    function getData() {
      const selectedValue = document.getElementById('sales').value;
      console.log(selectedValue);
      const mode = selectedValue;
      let options;
      if (mode === "Daily") {
        document.getElementById('chooseYear').style.display = "none";
        document.getElementById('chooseMonth').style.display = "none";
        document.getElementById('chooseDay').style.display = "block";
      } else if (mode === "Monthly") {
        document.getElementById('chooseDay').style.display = "none";
        document.getElementById('chooseYear').style.display = "none";
        document.getElementById('chooseMonth').style.display = "block";
      } else if (mode === "Yearly") {
        document.getElementById('chooseMonth').style.display = "none";
        document.getElementById('chooseDay').style.display = "none";
        document.getElementById('chooseYear').style.display = "block";
      } else {

      }
    }

    // For Creating Graph ****************************************************************
    function createGraph(data, type, id) {

      // Get a reference to the canvas element
      const ctx = document.getElementById(id).getContext('2d');

      // Set up your data for the chart
      const labels = data.map(item => item.label); // Assuming each data object has a 'label' property
      const values = data.map(item => item.value); // Assuming each data object has a 'value' property
      console.log("values", values);
      // Create the chart
      new Chart(ctx, {
        type: type, // Specify the type of chart you want (bar, line, pie, etc.)
        data: {
          labels: labels,
          datasets: [{
            label: 'My Data',
            data: values,
            backgroundColor: 'rgba(0, 123, 255, 0.5)' // Set a color for the bars
          }]
        },
        options: {
          // Configure additional options as needed
        }
      });
    }

    //Document Listener ******************************************************
    document.addEventListener('DOMContentLoaded', function () {
      const mode = 'Full';
      const url = `/admin/api/fetchSales?id=${mode}`;

      const options = {
        method: 'POST',
        Headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ id: url })
      }
      const type = 'bar';
      const id = "myChart"
      fetchSalesData(url, options, type, id)


    })






  </script>
  <%- include('./layout/footer.ejs') %>